(function(t){function e(t){function e(){}return e.prototype=t,new e}function n(t,e){var n=document.getElementsByTagName("head")[0]||document.insertBefore(document.firstChild.firstChild,document.createElement("head")),i=document.createElement("script");return i.onload=e||void 0,i.type="text/javascript",i.src=t,n.appendChild(i),i}function r(t,e){var n=!1,i=!0,r=t.document,s=r.documentElement,a=r.addEventListener?"addEventListener":"attachEvent",o=r.addEventListener?"removeEventListener":"detachEvent",c=r.addEventListener?"":"on",l=function(i){("readystatechange"!==i.type||"complete"===r.readyState)&&(("load"===i.type?t:r)[o](c+i.type,l,!1),!n&&(n=!0)&&e.call(t,i.type||i))},h=function(){try{s.doScroll("left")}catch(t){return setTimeout(h,50),void 0}l("poll")};if("complete"===r.readyState)e.call(t,"lazy");else{if(r.createEventObject&&s.doScroll){try{i=!t.frameElement}catch(d){}i&&h()}r[a](c+"DOMContentLoaded",l,!1),r[a](c+"readystatechange",l,!1),t[a](c+"load",l,!1)}}function s(){var t=c("./jsonp_request").JsonpRequest,e=c("./img_request").ImgRequest;return{jsonp:t.make,get:t.make,img:e.make}}if(!a){var a={};a.exports={};var o=a.exports,c=function(){return o}}o.copy=e;var l=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};o.merge=l,o.loadscript=n;var h={},d=function(){var t={load:[],click:[],readyStateChange:[]};this.listeners=function(e){return t[e]},this.addListener=function(e,n){return t[e]||(t[e]=[]),t[e].push(n),t[e]},this.on=function(t,e){return this.addListener(t,e)},this.emit=function(e,n){var i=t[e];if(i&&i.length>0){var r=0;for(r;i.length>r;r++)n&&i[r].call(this,n)||i[r].call();return i}}};h.EventEmitter=d,o.events=h;var u={parse:function(t){var e="&",n="=",i={};t=t.split(e);for(var r=0;t.length>r;r++){var s=t[r];s=s.split(n);var a=s[0],o=s[1];isNaN(o)||(o=parseInt(o,10)),i[a]=o}return i},stringify:function(t){var e="&",n="=",i=[];for(var r in t)if(t[r]&&"function"!=typeof t[r])if("object"==typeof t[r])for(var s in t[r]){var a=t[r][s];i.push(r+"["+s+"]"+n+a)}else i.push(r+n+t[r]);return i.join(e)}};o.querystring=u,o.contentloaded=r;var p=function(){var t=c("../utils/merge").merge;c("../node_modules/querystring").querystring,this.extend=function(e){return t(this,e)}};o.Core=p;var m=function(t){var e=c("./core").Core;e.apply(this,arguments);var n=new Date;this.type=void 0,this.campaign_id=void 0,this.ad_id=void 0,this.space_id=void 0,this.site_id=void 0,this.page_url=void 0,this.date=void 0,this.time=void 0,this.hour=void 0,this.ip=void 0,this.browser=void 0,this.visible=void 0,this.getFullDate=function(){return"object"==typeof n?n=n.toISOString():n},function(e){e=e.extend(t)}(this)};m.required=["type","ad_id","campaign_id"],m.track=function(t){return new m(t).save()},m.prototype.getDate=function(){return this.getFullDate().split("T")[0]},m.prototype.getTime=function(){return this.getFullDate().split("T")[1]},m.prototype.getHour=function(){return this.time?this.time.split(":")[0]:!1},m.prototype.validate=function(){for(var t=0;m.required.length>t;t++){var e=m.required[t];if(!this[e])return!1}return!0},m.prototype.toQuery=function(){var t=c("../node_modules/querystring").querystring;return t.stringify(this)},m.prototype.save=function(){throw Error("You should override this")},o.Event=m;var f=function(t){var e=c("./core").Core,n=c("../node_modules/events").events.EventEmitter;e.apply(this,arguments),n.apply(this,arguments),this.id="",this.name="",this.campaign_id="",this.type="",this.file="",this.link="",this.status=!0,this.alternative={},function(e){e=e.extend(t)}(this)};o.Ad=f;var g=function(){this.getAd=function(){throw Error("Implement it")}};o.ISpaceBehaviour=g;var v=function(){this.getAd=function(t){var e=t.ads,n=e.length,i=Math.floor(Math.random()*n),r=e[i];return e.splice(i,1),r}},y=function(t){var e=c("./core").Core;e.apply(this,arguments),this.id="",this.type="",this.status="",this.ads=[],this.behaviour={},this.setBehaviour=function(t){return this.behaviour=t,this.behaviour},this.getAd=function(){return this.behaviour.getAd(this)},function(e){e=e.extend(t),e.setBehaviour(new v)}(this)};o.Space=y;var w=function(t){var e=c("./core").Core;e.apply(this,arguments),this.id="",this.name="",this.spaces=[],this.status=!0,function(e){e=e.extend(t)}(this)};w.prototype.getActiveContent=function(){return this.spaces&&this.spaces.length>=1&&(this.spaces=this.spaces.map(function(t){return t.ads&&t.ads.length>=1&&(t.ads=t.ads.filter(function(t){return t.status})),t})),this},o.Page=w;var b=function(t){var e=c("./core").Core;e.apply(this,arguments),this.id="",this.name="",this.status=!0,this.domains=[],function(e){e=e.extend(t)}(this)};b.prototype.hasDomain=function(t){function e(t,e){return-1!==e.indexOf(t)}var n=!1;return e(t,this.domains)?n=!0:this.domains.forEach(function(i){var r=e("*",i);r&&(i=i.replace("*",""),e(i,t)&&(n=!0))}),n},o.Site=b;var k=function(){function t(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}var e=c("../domain/core").Core,n=c("../node_modules/querystring").querystring;e.apply(this,arguments),this.host="",this.protocol="http",this.port=80,this.path="",this.qs={},this.query="",this.url="",this.getUrl=function(){return this.url||(this.url=this.protocol,this.url+="://",this.url+=this.host,this.url+=this.path,t(this.qs)||(this.query=[this.query,n.stringify(this.qs)].join("&")),this.query&&(this.url+="?"+this.query)),this.url}};o.Http=k;var E=function(t,e){var n=c("./http").Http;n.apply(this,arguments),this.callback=void 0,function(n){"string"==typeof t?n.url=t:n=n.extend(t),n.callback=e||n.callback}(this)};o.HttpRequest=E;var q=function(){var t=c("./http_request").HttpRequest;t.apply(this,arguments)};q.prototype.send=function(t){t&&(this.qs=t);var e=q.document||document,n=e.createElement("img");return n.src=this.getUrl(),this.callback&&(n.onload=this.callback.apply({ok:!0})),this},q.document=void 0,q.make=function(t,e,n){var i=new q(t,e);return n&&(i.document=n),i.send(),i},o.ImgRequest=q;var A=function(){var t=c("./http_request").HttpRequest;t.apply(this,arguments)};A.prototype.queryCallback=function(t){return this.qs.callback=t,this},A.prototype.validate=function(){return void 0!==this.qs.callback},A.prototype.send=function(t){function e(t,e){var n=e.createElement("script");return n.type="text/javascript",n.src=t,e.getElementsByTagName("head")[0].appendChild(n),n}return t&&(this.qs=t),e(this.getUrl(),A.document||document),this},A.document=void 0,A.make=function(t,e){function n(t){function e(e){e?t(null,e):t(Error("No Response"),null)}return e}var i=new A(t,n(e));return i.send(),i},o.JsonpRequest=A,o.request=s;var _=function(t){var e=c("../request/http").Http;e.apply(this,arguments),this._index=0,this.name="",this.requests={},function(e){"string"==typeof t?e.url=t:e=e.extend(t)}(this)};_.prototype.id=function(){return"n"+this._index},_.prototype.newId=function(){return this._index++,this.id()},_.prototype.next=function(t){var e=this.newId();this.requests[e]=t},_.prototype.getCallbackPath=function(){return[this.name,"requests",this.id(),"callback"].join(".")},_.prototype.request=c("../request/request").request,_.prototype.get=function(t,e,n){return"function"==typeof e&&(n=e),e.callback=this.getCallbackPath(),this.path=t,this.qs=e,this.requests[this.id()]={},this.request().get(this,n),this.newId(),this},o.Connection=_;var S=function(){this.id="",this.element=void 0};S.create=function(t,e){return e.createElement(t)},S.prototype.create=function(e,n){return n=this.document||t.document||n,this.element=S.create(e,n),this.element},S.prototype.setAttributes=function(t){var e=c("../utils/merge").merge;e(this.element,t)},S.prototype.append=function(t){return this.element.appendChild(t),this},S.prototype.findParentTag=function(t){var e=this.element.parentNode;if(e){for(;e.nodeName!=t;)e=e.parentNode;return e}return!1},S.prototype.addDomEventListener=function(t,e){return"function"==typeof addEventListener?this.element.addEventListener(t,e,!1):"function"==typeof attachEvent?this.element.attachEvent("on"+t,e):this.element["on"+t]=e,this},o.DomElement=S,function(){var t=c("./dom_element").DomElement,e=c("../domain/ad").Ad,n=c("../domain/event").Event,i=function(){e.apply(this,arguments),this.trackerUrl=null,this.impression={}};i.prototype=new t,i.prototype.getSpaceId=function(){var t=this.findParentTag("DIV");return t.id},i.prototype.isVisible=function(){var t=this.element.ownerDocument,e={top:t.body.scrollTop||t.documentElement.scrollTop,left:t.body.scrollLeft||t.documentElement.scrollLeft,height:t.documentElement.clientHeight,width:t.documentElement.clientWidth},n={top:this.element.offsetTop,left:this.element.offsetLeft,height:this.element.offsetHeight,width:this.element.offsetWidth,style:t.defaultView.getComputedStyle(this.element,null)};n.halfHeight=n.height/2,n.halfWidth=n.width/2;var i=n.left+n.halfWidth<=e.width&&n.left+n.halfWidth>=e.left&&n.left>=0,r=n.top+n.halfHeight<=e.height&&n.top+n.halfHeight>=e.top&&n.top>=0,s=!0,a=!0;n.style&&(s="none"!=n.style.display,a="hidden"!=n.style.visibility);var o=i&&r&&s&&a;return o},i.prototype.setImpression=function(t,e){var n=this.element.ownerDocument,i={height:n.documentElement.clientHeight,width:n.documentElement.clientWidth};return this.element.offsetLeft<=i.width&&this.element.offsetLeft>=0,this.element.offsetTop<=i.height&&this.element.offsetTop>=0,e.visible=this.isVisible(),e.type="impression",e.ad_id=this.id,t&&(e.space_id=t.id||delete e.space_id),e.campaign_id=this.campaign_id,this.impression=e,this.impression},i.prototype.getClickTag=function(t){var e=this.trackerUrl,i=new n({ad_id:this.id,type:"click",campaign_id:this.campaign_id,space_id:this.getSpaceId(),site_id:t.site_id,page_id:t.page_id,page_url:t.page_url,link:escape(this.link)});if(i.validate()&&this.link){var r=[e,"click",this.id].join("/");return r=r+"?"+i.toQuery()}return!1},o.AdDom=i}(),function(){var t=c("./dom_element").DomElement,e=c("../domain/space").Space,n=function(){e.apply(this,arguments),this.placements={},this.ad={}};n.prototype=new t,n.prototype.placeAd=function(t){return this.element.innerHTML="",this.element.appendChild(t.element),t.emit("placement"),this.ad=t,this},n.prototype.getElement=function(){return this.document.getElementById(this.id)},o.SpaceDom=n}();var x=function(){var t=c("../node_modules/querystring").querystring;this.align="center",this.menu=!1,this.quality="high",this.scale="noscale",this.wmode="transparent",this.type="application/x-shockwave-flash",this.allowScriptAccess="always",this.allowNetworking="all",this.getSrc=function(){if(!this.preloader)return this.src;var e=this.preloader+"?"+t.stringify({src:this.src,link:this.link,callback:this.callback,value:this.id});return e}};o.Swf=x,function(){var t=c("../dom/ad_dom").AdDom,e=c("./swf").Swf,n=function(){t.apply(this,arguments),e.apply(this,arguments),function(t){return t.create("EMBED"),t.element.src=t.getSrc(),t.element.setAttribute("height",t.height),t.element.setAttribute("width",t.width),t.element.setAttribute("type",t.type),t.element.setAttribute("allowScriptAccess",t.allowScriptAccess),t.element.setAttribute("allowNetworking",t.allowNetworking),t.element.setAttribute("menu",t.menu),t.element.setAttribute("wmode",t.wmode),t.element.setAttribute("scale",t.scale),t.element.setAttribute("quality",t.quality),t.element.id=t.id,t.element}(this)};n.prototype=new t,o.EmbedAd=n}(),function(){var t=c("../dom/ad_dom").AdDom,e=c("./swf").Swf,n=function(){var n=this;t.apply(this,arguments),e.apply(this,arguments);var i="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",r="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0",s=function(t,e){return this.name=t,this.value=e,this.element=n.create("param"),this.element.setAttribute("name",this.name),this.element.setAttribute("value",this.value),this.element};(function(t){t.create("OBJECT"),t.element.src=t.src,t.element.setAttribute("data",t.src),t.element.setAttribute("classid",i),t.element.setAttribute("codebase",r);var e=t.element.cloneNode(!0);return e.appendChild(new s("movie",t.getSrc())),e.appendChild(new s("quality",t.quality)),e.appendChild(new s("src",t.src)),e.appendChild(new s("menu",t.menu)),e.appendChild(new s("scale",t.scale)),e.appendChild(new s("allowScriptAccess",t.allowScriptAccess)),e.appendChild(new s("allowNetworking","all")),e.appendChild(new s("base",t.base)),e.appendChild(new s("wmode",t.wmode)),t.element=e,t.element.id=t.id,t.element})(this)};n.prototype=new t,o.ObjectAd=n}(),function(){var t=c("../dom/ad_dom").AdDom,e=function(){t.apply(this,arguments),function(t){t.create("img"),t.element.src=t.src;var e=t.element;return t.element.id=t.id,t.addDomEventListener("load",function(){t.emit("load")}),t.link&&(t.create("a"),t.element.href=t.link,t.on("placement",function(){var e=t.getClickTag(t.impression);t.element.href=e}),t.append(e),t.element.onclick=function(){return window.open(t.element.href),!1}),t.element.style.height=t.height+"px",t.element.style.width=t.width+"px",t.element.setAttribute("height",t.height),t.element.setAttribute("width",t.width),t.element}(this)};e.prototype=new t,o.ImgAd=e}(),function(){var t=c("../dom/ad_dom").AdDom,e=function(){t.apply(this,arguments),function(t){return t.create("iframe"),t.element.src=t.src,t.element,t.element.id=t.id,t.addDomEventListener("load",function(){t.emit("load")}),t.element.style.height=t.height+"px",t.element.style.width=t.width+"px",t.element.setAttribute("height",t.height),t.element.setAttribute("width",t.width),t.element.setAttribute("frameborder","0"),t.element.setAttribute("scrolling","no"),t.element}(this)};e.prototype=new t,o.HtmlAd=e}(),function(){var t=c("./embed_ad.js").EmbedAd,e=c("./object_ad.js").ObjectAd,n=function(n){var i=function(i){return i.browser?new e(n):new t(n)}(this);return i};o.FlashAd=n}(),function(){o.ads=function(){var t=c("./flash_ad.js").EmbedAd,e=c("./img_ad.js").ImgAd,n=c("./html_ad.js").HtmlAd;return{create:function(i){switch(i.id=i._id||i.id,i.src=i.file,delete i.file,delete i._id,i.type){case"flash":return i.preloader="http://xframe.adlayerjavascriptsdk.com/main.swf",i.callback="adlayer.markAdAsLoaded",new t(i);case"image":return new e(i);case"html":return new n(i)}}}}()}(),function(){var t=c("../dom/space_dom").SpaceDom,e=c("../ads/ads").ads,n=function(){t.apply(this,arguments)};n.prototype=new t,n.prototype.init=function(t,n){if(this.ads&&this.ads.length>0){var i=e.create(this.getAd());i.trackerUrl=t.connection.getUrl();var r=this;i.on("load",function(){i.setImpression(r,n),t.track(i.impression)}),this.placeAd(i)}return this},o.BasicSpace=n}(),function(){var t=c("./basic_space").BasicSpace,e=function(){t.apply(this,arguments),this.expandEvent="mouseover",this.retreatEvent="mouseout",function(t){t.element=t.element||t.getElement()||t.create("DIV"),t.element.id=t.id,t.element.style.height=t.height,t.element.style.width=t.width,t.element.style.position="absolute",t.addDomEventListener(t.expandEvent,function(){t.expand(),t.state="expanded"}),t.addDomEventListener(t.retreatEvent,function(){t.retract(),t.state="retreated"}),t.retract()}(this)};e.prototype=new t,e.prototype.clip=function(t,e){return this.element.style.clip="rect(0px "+t+" "+e+" 0px)",this},e.prototype.expand=function(){var t=this.element.firstChild;if(t){var e=t.style.width||t.width+"px",n=t.style.height||t.height+"px";return this.clip(e,n),this}},e.prototype.retract=function(){return this.clip(this.width,this.height),this},o.ExpandableSpace=e}(),function(){var t=c("./basic_space").BasicSpace,e=function(){t.apply(this,arguments),this.close=function(){var t=this.element;t.parentNode.removeChild(t),delete this.element},function(t){t.element=t.element||t.getElement()||t.create("DIV"),t.element.id=t.id,t.element.style.height=t.height,t.element.style.width=t.width,t.element.style.position="absolute";var e=t.document.createElement("BUTTON");e.innerHTML="x",e.onclick=function(){t.close()},t.append(e)}(this)};e.prototype=new t,o.FloaterSpace=e}(),function(){var t=c("./basic_space").BasicSpace,e=function(){t.apply(this,arguments),function(t){t.element=t.element||t.getElement()||t.create("DIV"),t.element.style.height=t.height,t.element.style.width=t.width,t.element.id=t.id}(this)};e.prototype=new t,o.StaticSpace=e}(),function(){o.spaces=function(){var t=c("./expandable_space.js").ExpandableSpace,e=c("./floater_space.js").FloaterSpace,n=c("./static_space.js").StaticSpace;return{create:function(i){switch(i.id=i._id||i.id,i.width=i.width||i.size.width,i.height=i.height||i.size.height,delete i._id,delete i.size,i.type){case"expandable":return new t(i);case"floater":return new e(i);case"static":return new n(i)}}}}()}(),o.config={url:{adserver:{host:"jocasta.adlayerapp.com"},tracker:{host:"tracker.adlayerapp.com"}},adsPerSpace:1,page:{scriptTagId:"adlayerScript"},widgets:{}},function(){function t(){this.connection={}}var e=c("../utils/copy").copy,n=c("../domain/core").Event;t.prototype.track=function(t){var i=new n(t),r=e(this.connection);if(r.host=r.host,r.path="/"+i.type+"/"+i.ad_id,i.validate()){r.qs=i;var a=s().img(r,function(t){if(t)throw Error({message:"impossible to track"})});this.connection.next(a)}},o.Tracker=t}(),function(){c("../lib/src/utils/merge").merge;var t=function(t,e){this.connection=t,this.targeting=e};t.prototype.request=function(t,n,i){var r=this.connection.newId(),a=e(this.connection);a.host=a.host,a.path=t,a.qs=n||{},a.qs.targeting=this.targeting||{},a.qs.callback="adlayer.connections."+a.name+".requests."+r+".callback";var o=s().get(a,i);this.connection.requests[r]=o},t.prototype.pages=function(t,e,n){this.request("/pages/"+t,e,n)},t.prototype.ads=function(t,e,n){this.request("/ads/"+t,e,n)},t.prototype.spaces=function(t,e,n){this.request("/spaces/"+t,e,n)},o.Adserver=t}();var C=c("./config").config,_=c("../lib/connection/connection").Connection,d=c("../lib/node_modules/events").events.EventEmitter,D=c("../tracker/tracker").Tracker,L=c("./adserver").Adserver,T=function(t){this.lib={},this.plugins=t.plugins||null,this.config=C,this.targeting=t.targeting,this.connections=t.connections||{},this.adserver=t.adserver||{},this.tracker=t.tracker||{},this.spaces=t.spaces||{},this.ads=t.ads||{},this.page=t.page||{},function(e){t.config&&(e.config.url=t.config.url||e.config.url,e.config.adsPerSpace=t.adsPerSpace||e.config.adsPerSpace,e.config.page=t.config.page||e.config.page),e.connect()}(this)};T.prototype=new d,T.prototype.markAdAsLoaded=function(t){var e=this.ads[t];e.emit("load")},T.prototype.connect=function(){var t=this.config;this.connections.adserver||(this.connections.adserver=new _(t.url.adserver),this.connections.adserver.name="adserver"),this.connections.tracker||(this.connections.tracker=new _(t.url.tracker),this.connections.tracker.name="tracker"),this.adserver=new L,this.adserver.connection=this.connections.adserver,this.adserver.targeting=this.targeting,this.tracker=new D,this.tracker.connection=this.connections.tracker},o.Adlayer=T,function(t){var e=c("./adlayer").Adlayer,n=c("../config/config").config,i=i||t,r=i.adlayer||{},s=r.config||{};r.page=r.page||null,r.plugins=r.plugins||null,r.config=n;for(var a in s){var o=s[a];o&&(r.config[a]=o)}r.targeting=r.targeting,r.connections=r.connections,r.adserver=r.adserver||null,r.tracker=r.tracker||null,r.spaces=r.spaces||null,r.ads=r.ads||null;var l=new e(r);l.lib=c("*"),i.adlayer=l}(this),function(){var t=c("../lib/src//node_modules/events").events.EventEmitter,e=c("../lib/src/domain/page").Space;c("../lib/src/request/request").request;var n=c("../lib/src/spaces/spaces").spaces,i=function(){e.apply(this,arguments),t.apply(this,arguments),this.document,this.tracker,this.adserver,this.ad={}};i.prototype.getData=function(t){var e={ads_per_space:this.adsPerSpace};this.adserver.spaces(this.id,e,t)},i.prototype.renderSpace=function(t,e){t.document=this.document;var i=n.create(t);e=e||{};var r=i.init(this.tracker,e);return this.element=r.element,r.ad&&(this.ad=r.ad,this.ads=r.ads),this.width=t.width,this.height=t.height,this.type=t.type,this.id=t.id,this},i.prototype.init=function(t){var e=this;return this.getData(function(n,i){if(!n&&i){var r=e.renderSpace(i);t&&t.call(r)}}),this},o.SpaceApi=i}(),function(e){function n(t,e,n){var r=[];null===e&&(e=document),null==n&&(n="*");var s=e.getElementsByTagName(n),a=s.length,o=RegExp("(^|\\s)"+t+"(\\s|$)");for(i=0,j=0;a>i;i++)o.test(s[i].className)&&(r[j]=s[i],j++);return r}(function(){var i=e.adlayer,r=i.lib.SpaceApi,s=c("../lib/src/utils/contentloaded").contentloaded,a=i.config,o={};if(i.plugins)for(var l in i.plugins){var h=i.plugins[l];if("spaces"===h.widget||"spaces"===h.widget)for(var d in h.events){var u=o[d]||[];u.push(h.events[d]),o[d]=u}}s(t,function(){for(var e=t.document,s=n("adlayer_space_global",e),c=0;s.length>c;c++){var l=s[c],h=new r({id:l.id,adserver:i.adserver,tracker:i.tracker,document:e,adsPerSpace:a.adsPerSpace});(function(t,e){t.init(function(){if(e.spaces[this.id]=this,e.ads[this.ad.id]=this.ad,o.placement)for(var t=0;o.placement.length>t;t++){var n=o.placement[t];n(e.spaces[this.id])}})})(h,i)}})})()}(this)})(this);
//@ sourceMappingURL=spaces.min.js.map