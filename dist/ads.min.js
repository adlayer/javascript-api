
(function(e){function o(e){function t(){}return t.prototype=e,new t}function a(e,t,n){var r=document.getElementsByTagName("head")[0]||document.insertBefore(document.firstChild.firstChild,document.createElement("head")),i=document.createElement("script");return i.onload=t||undefined,i.type="text/javascript",i.src=e,r.appendChild(i),i}function h(e,t){var n=!1,r=!0,i=e.document,s=i.documentElement,o=i.addEventListener?"addEventListener":"attachEvent",u=i.addEventListener?"removeEventListener":"detachEvent",a=i.addEventListener?"":"on",f=function(r){if(r.type==="readystatechange"&&i.readyState!=="complete")return;(r.type==="load"?e:i)[u](a+r.type,f,!1),!n&&(n=!0)&&t.call(e,r.type||r)},l=function(){try{s.doScroll("left")}catch(e){setTimeout(l,50);return}f("poll")};if(i.readyState==="complete")t.call(e,"lazy");else{if(i.createEventObject&&s.doScroll){try{r=!e.frameElement}catch(c){}r&&l()}i[o](a+"DOMContentLoaded",f,!1),i[o](a+"readystatechange",f,!1),e[o](a+"load",f,!1)}}function N(){var e=s("./jsonp_request").JsonpRequest,t=s("./img_request").ImgRequest;return{jsonp:e.make,get:e.make,img:t.make}}var t={},n={};n.exports={};var r=n.exports,s=function(e){return r};r.copy=o;var u=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};r.merge=u,r.loadscript=a;var f={},l=function(){var e={load:[],click:[],readyStateChange:[]};this.listeners=function(t){return e[t]},this.addListener=function(t,n){return e[t]||(e[t]=[]),e[t].push(n),e[t]},this.on=function(e,t){return this.addListener(e,t)},this.emit=function(t){var n=e[t];if(n&&n.length>0){var r=0;for(r;r<n.length;r++)n[r].call();return n}}};f.EventEmitter=l,r.events=f;var c={parse:function(e){var t="&",n="=",r={};e=e.split(t);for(var i=0;i<e.length;i++){var s=e[i];s=s.split(n);var o=s[0],u=s[1];isNaN(u)||(u=parseInt(u,10)),r[o]=u}return r},stringify:function(e){var t="&",n="=",r=[];for(var i in e)e[i]&&typeof e[i]!="function"&&r.push(i+n+e[i]);return r.join(t)}};r.querystring=c,r.contentloaded=h;var p=function(){var e=s("../utils/merge").merge,t=s("../node_modules/querystring").querystring;this.extend=function(t){return e(this,t)}};r.Core=p;var d=function(e){var t=s("./core").Core;t.apply(this,arguments);var n=new Date;this.type=undefined,this.campaign_id=undefined,this.ad_id=undefined,this.space_id=undefined,this.site_id=undefined,this.page_url=undefined,this.date=undefined,this.time=undefined,this.hour=undefined,this.ip=undefined,this.browser=undefined,this.getFullDate=function(){return typeof n=="object"?(n=n.toISOString(),n):n};var r=function(t){t=t.extend(e)}(this)};d.required=["type","ad_id","campaign_id"],d.track=function(e){return(new d(e)).save()},d.prototype.getDate=function(){return this.getFullDate().split("T")[0]},d.prototype.getTime=function(){return this.getFullDate().split("T")[1]},d.prototype.getHour=function(){return this.time?this.time.split(":")[0]:!1},d.prototype.validate=function(){for(var e=0;e<d.required.length;e++){var t=d.required[e];if(!this[t])return!1}return!0},d.prototype.toQuery=function(){var e=s("../node_modules/querystring").querystring;return e.stringify(this)},d.prototype.save=function(){throw new Error("You should override this")},r.Event=d;var v=function(e){var t=s("./core").Core,n=s("../node_modules/events").events.EventEmitter;t.apply(this,arguments),n.apply(this,arguments),this.id="",this.name="",this.campaign_id="",this.type="",this.file="",this.link="",this.status=!0,this.alternative={};var r=function(t){t=t.extend(e)}(this)};r.Ad=v;var m=function(){this.getAd=function(e){throw new Error("Implement it")}};r.ISpaceBehaviour=m;var g=function(){this.getAd=function(e){var t=e.ads,n=t.length,r=Math.floor(Math.random()*n),i=t[r];return t.splice(r,1),i}},y=function(e){var t=s("./core").Core;t.apply(this,arguments),this.id="",this.type="",this.status="",this.ads=[],this.behaviour={},this.setBehaviour=function(e){return this.behaviour=e,this.behaviour},this.getAd=function(){return this.behaviour.getAd(this)};var n=function(t){t=t.extend(e),t.setBehaviour(new g)}(this)};r.Space=y;var b=function(e){var t=s("./core").Core;t.apply(this,arguments),this.id="",this.name="",this.spaces=[],this.status=!0;var n=function(t){t=t.extend(e)}(this)};b.prototype.getActiveContent=function(){return this.spaces&&this.spaces.length>=1&&(this.spaces=this.spaces.map(function(e){return e.ads&&e.ads.length>=1&&(e.ads=e.ads.filter(function(e){return e.status})),e})),this},r.Page=b;var w=function(e){var t=s("./core").Core;t.apply(this,arguments),this.id="",this.name="",this.status=!0,this.domains=[];var n=function(t){t=t.extend(e)}(this)};w.prototype.hasDomain=function(e){function r(e,t){return t.indexOf(e)!==-1}var t=this,n=!1;return r(e,this.domains)?n=!0:this.domains.forEach(function(t){var i=r("*",t);i&&(t=t.replace("*",""),r(t,e)&&(n=!0))}),n},r.Site=w;var E=function(){function n(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var e=s("../domain/core").Core,t=s("../node_modules/querystring").querystring;e.apply(this,arguments),this.host="",this.protocol="http",this.port=80,this.path="",this.qs={},this.query="",this.url="",this.getUrl=function(){return this.url||(this.url=this.protocol,this.url+="://",this.url+=this.host,this.url+=this.path,n(this.qs)||(this.query=[this.query,t.stringify(this.qs)].join("&")),this.query&&(this.url+="?"+this.query)),this.url}};r.Http=E;var S=function(e,t){var n=s("./http").Http;n.apply(this,arguments),this.callback=undefined;var r=function(n){typeof e=="string"?n.url=e:n=n.extend(e),n.callback=t||n.callback}(this)};r.HttpRequest=S;var x=function(){var e=s("./http_request").HttpRequest;e.apply(this,arguments)};x.prototype.send=function(e){e&&(this.qs=e);var t=x.document||document,n=t.createElement("img");return n.src=this.getUrl(),this.callback&&(n.onload=this.callback.apply({ok:!0})),this},x.document=undefined,x.make=function(e,t,n){var r=new x(e,t);return n&&(r.document=n),r.send(),r},r.ImgRequest=x;var T=function(){var e=s("./http_request").HttpRequest;e.apply(this,arguments)};T.prototype.queryCallback=function(e){return this.qs.callback=e,this},T.prototype.validate=function(){return this.qs.callback!==undefined},T.prototype.send=function(e){function t(e,t){var n=t.createElement("script");return n.type="text/javascript",n.src=e,t.getElementsByTagName("head")[0].appendChild(n),n}return e&&(this.qs=e),t(this.getUrl(),T.document||document),this},T.document=undefined,T.make=function(e,t){function n(e){function t(t){t?e(null,t):e(new Error("No Response"),null)}return t}var r=new T(e,n(t));return r.send(),r},r.JsonpRequest=T,r.request=N;var C=function(e){var t=s("../request/http").Http;t.apply(this,arguments),this._index=0,this.name="",this.requests={};var n=function(t){typeof e=="string"?t.url=e:t=t.extend(e)}(this)};C.prototype.id=function(){return"n"+this._index},C.prototype.newId=function(){return this._index++,this.id()},C.prototype.next=function(e){var t=this.newId();this.requests[t]=e},C.prototype.getCallbackPath=function(){return[this.name,"requests",this.id(),"callback"].join(".")},C.prototype.request=s("../request/request").request,C.prototype.get=function(e,t,n){return typeof t=="function"&&(n=t),t.callback=this.getCallbackPath(),this.path=e,this.qs=t,this.requests[this.id()]={},this.request().get(this,n),this.newId(),this},r.Connection=C,function(){function n(){this.connection={}}var e=s("../utils/copy").copy,t=s("../domain/core").Event;n.prototype.track=function(n){var r=new t(n),i=e(this.connection);i.host=i.host,i.path="/"+r.type+"/"+r.ad_id;if(r.validate()){i.qs=r;var s=N().img(i,function(e,t){if(e)throw new Error({message:"impossible to track"})});this.connection.next(s)}},r.Tracker=n}();var k=function(){this.id="",this.element=undefined};k.create=function(e,t){return t.createElement(e)},k.prototype.create=function(t,n){return n=this.document||e.document||n,this.element=k.create(t,n),this.element},k.prototype.setAttributes=function(e){var t=s("../utils/merge").merge;t(this.element,e)},k.prototype.append=function(e){return this.element.appendChild(e),this},k.prototype.findParentTag=function(e){var t=this.element.parentNode;if(t){while(t.nodeName!=e)t=t.parentNode;return t}return!1},k.prototype.addDomEventListener=function(e,t){return typeof addEventListener=="function"?this.element.addEventListener(e,t,!1):typeof attachEvent=="function"?this.element.attachEvent("on"+e,t):this.element["on"+e]=t,this},r.DomElement=k,function(){var e=s("./dom_element").DomElement,t=s("../domain/ad").Ad,n=s("../domain/event").Event,i=function(){t.apply(this,arguments),this.tracker={}};i.prototype=new e,i.prototype.getSpaceId=function(){var e=this.findParentTag("DIV");return e.id},i.prototype.getClickTag=function(e){var t=this.tracker.connection.getUrl(),r=new n({ad_id:this.id,type:"click",campaign_id:this.campaign_id,space_id:this.getSpaceId(),site_id:e.site_id,page_id:e.page_id,page_url:e.page_url,link:this.link});if(r.validate()&&this.link){var i=[t,"click",this.id].join("/");return i=i+"?"+r.toQuery(),i}return!1},i.prototype.init=function(e,t){var n=this;return t.ad_id=n.id,t.space_id=e.id,t.space_id||delete t.space_id,t.campaign_id=n.campaign_id,n.on("load",function(){t.type="impression",n.tracker.track(t)}),n.on("placement",function(){var e=n.getClickTag(t);n.element.href=e}),n},r.AdDom=i}(),function(){var e=s("./dom_element").DomElement,t=s("../domain/space").Space,n=function(){t.apply(this,arguments),this.placements={},this.ad={}};n.prototype=new e,n.prototype.placeAd=function(e){return this.element.appendChild(e.element),e.emit("placement"),this.ad=e,this},n.prototype.getElement=function(){return this.document.getElementById(this.id)},r.SpaceDom=n}();var L=function(){var e=s("../node_modules/querystring").querystring;this.align="center",this.menu=!1,this.quality="high",this.scale="noscale",this.wmode="transparent",this.type="application/x-shockwave-flash",this.allowScriptAccess="always",this.allowNetworking="all",this.getSrc=function(){if(!this.preloader)return this.src;var t=this.preloader+"?"+e.stringify({src:this.src,callback:this.callback,value:this.id});return t}};r.Swf=L,function(){var e=s("../dom/ad_dom").AdDom,t=s("./swf").Swf,n=function(){e.apply(this,arguments),t.apply(this,arguments);var n=function(e){return e.create("EMBED"),e.element.src=e.getSrc(),e.element.setAttribute("height",e.height),e.element.setAttribute("width",e.width),e.element.setAttribute("type",e.type),e.element.setAttribute("allowScriptAccess",e.allowScriptAccess),e.element.setAttribute("allowNetworking",e.allowNetworking),e.element.setAttribute("menu",e.menu),e.element.setAttribute("wmode",e.wmode),e.element.setAttribute("scale",e.scale),e.element.setAttribute("quality",e.quality),e.element.id=e.id,e.element}(this)};n.prototype=new e,r.EmbedAd=n}(),function(){var e=s("../dom/ad_dom").AdDom,t=s("./swf").Swf,n=function(){var n=this;e.apply(this,arguments),t.apply(this,arguments);var r="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",i="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0",s="http://www.macromedia.com/go/getflashplayer",o=function(e,t){return this.name=e,this.value=t,this.element=n.create("param"),this.element.setAttribute("name",this.name),this.element.setAttribute("value",this.value),this.element},u=function(e){e.create("OBJECT"),e.element.src=e.src,e.element.setAttribute("data",e.src),e.element.setAttribute("classid",r),e.element.setAttribute("codebase",i);var t=e.element.cloneNode(!0);return t.appendChild(new o("movie",e.getSrc())),t.appendChild(new o("quality",e.quality)),t.appendChild(new o("src",e.src)),t.appendChild(new o("menu",e.menu)),t.appendChild(new o("scale",e.scale)),t.appendChild(new o("allowScriptAccess",e.allowScriptAccess)),t.appendChild(new o("allowNetworking","all")),t.appendChild(new o("base",e.base)),t.appendChild(new o("wmode",e.wmode)),e.element=t,e.element.id=e.id,e.element}(this)};n.prototype=new e,r.ObjectAd=n}(),function(){var e=s("../dom/ad_dom").AdDom,t=function(){e.apply(this,arguments);var t=function(e){e.create("img"),e.element.src=e.src;var t=e.element;return e.element.id=e.id,e.addDomEventListener("load",function(){e.emit("load")}),e.link&&(e.create("a"),e.element.href=e.link,e.append(t)),e.element.style.height=e.height+"px",e.element.style.width=e.width+"px",e.element.setAttribute("height",e.height),e.element.setAttribute("width",e.width),e.element}(this)};t.prototype=new e,r.ImgAd=t}(),function(){var e=s("./embed_ad.js").EmbedAd,t=s("./object_ad.js").ObjectAd,n=function(n){var r=function(r){return r.browser?new t(n):new e(n)}(this);return r};r.FlashAd=n}(),function(){r.ads=function(){var e=s("./flash_ad.js").EmbedAd,t=s("./img_ad.js").ImgAd;return{create:function(n){n.id=n._id,n.src=n.file,delete n.file,delete n._id;switch(n.type){case"flash":return n.preloader="http://xframe.adlayerjavascriptsdk.com.s3.amazonaws.com/as3.swf",n.callback="adlayer.markAdAsLoaded",new e(n);case"image":return new t(n)}}}}()}(),function(){var e=s("../dom/space_dom").SpaceDom,t=s("../ads/ads").ads,n=function(){e.apply(this,arguments),this.placements={},this.ad={}};n.prototype=new e,n.prototype.init=function(e,n){if(this.ads&&this.ads.length>0){var r=t.create(this.getAd());r.tracker=e,r=r.init(this,n),this.placeAd(r)}return this},r.BasicSpace=n}(),function(){var e=s("./basic_space").BasicSpace,t=function(){e.apply(this,arguments),this.expandEvent="mouseover",this.retreatEvent="mouseout";var t=function(e){e.element=e.element||e.getElement()||e.create("DIV"),e.element.id=e.id,e.element.style.height=e.height,e.element.style.width=e.width,e.element.style.position="absolute",e.addDomEventListener(e.expandEvent,function(){e.expand(),e.state="expanded"}),e.addDomEventListener(e.retreatEvent,function(){e.retract(),e.state="retreated"}),e.retract()}(this)};t.prototype=new e,t.prototype.clip=function(e,t){return this.element.style.clip="rect(0px "+e+" "+t+" 0px)",this},t.prototype.expand=function(){var e=this.element.firstChild;if(e){var t=e.style.width||e.width+"px",n=e.style.height||e.height+"px";return this.clip(t,n),this}},t.prototype.retract=function(){return this.clip(this.width,this.height),this},r.ExpandableSpace=t}(),function(){var e=s("./basic_space").BasicSpace,t=function(){e.apply(this,arguments),this.close=function(){var e=this.element;e.parentNode.removeChild(e),delete this.element};var t=function(e){e.element=e.element||e.getElement()||e.create("DIV"),e.element.id=e.id,e.element.style.height=e.height,e.element.style.width=e.width,e.element.style.position="absolute";var t=e.document.createElement("BUTTON");t.innerHTML="x",t.onclick=function(){e.close()},e.append(t)}(this)};t.prototype=new e,r.FloaterSpace=t}(),function(){var e=s("./basic_space").BasicSpace,t=function(){e.apply(this,arguments);var t=function(e){e.element=e.element||e.getElement()||e.create("DIV"),e.element.style.height=e.height,e.element.style.width=e.width,e.element.id=e.id}(this)};t.prototype=new e,r.StaticSpace=t}(),function(){r.spaces=function(){var e=s("./expandable_space.js").ExpandableSpace,t=s("./floater_space.js").FloaterSpace,n=s("./static_space.js").StaticSpace;return{create:function(r){r.id=r._id,r.width=r.size.width,r.height=r.size.height,delete r._id,delete r.size;switch(r.type){case"expandable":return new e(r);case"floater":return new t(r);case"static":return new n(r)}}}}()}(),r.config={url:{adserver:{host:"jocasta.adlayerapp.com"},tracker:{host:"tracker.adlayerapp.com"}},adsPerSpace:1,page:{autoRun:!0,scriptTagId:"adlayerScript"}},function(){var e=function(e){this.connection=e};e.prototype.request=function(e,t,n){var r=this.connection.id(),i=o(this.connection);i.host=i.host,i.path=e,i.qs=t||{},i.qs.callback="adlayer.connections."+i.name+".requests."+r+".callback";var s=N().get(i,n);this.connection.requests[r]=s},e.prototype.pages=function(e,t,n){this.request("/pages/"+e,t,n)},e.prototype.ads=function(e,t,n){this.request("/ads/"+e,t,n)},e.prototype.spaces=function(e,t,n){this.request("/spaces/"+e,t,n)},r.Adserver=e}(),function(){var e=s("../node_modules/events").events.EventEmitter,t=s("../lib/dom/ad_dom").AdDom,n=s("./lib/src/ads/ads").ads,i=s("../request/request").request,o=s("../spaces/spaces").spaces,u=function(){t.apply(this,arguments),this.document,this.tracker,this.adserver};u.prototype.getData=function(e){this.adserver.ads(this.id,null,e)},u.prototype.init=function(e,t){var r=this;return this.getData(function(i,s){if(!i&&s){var o=n.create(s);o.tracker=e,o.init({id:undefined},{}),o.emit("placement"),r.element=o.element,t.call(o)}}),this},r.AdApi=u}(),function(e){var t=s("../connection/connection").Connection,n=s("../tracker/tracker").Tracker,r=s("./adserver").Adserver,i=s("../config/config").config,o=o||e,u=o.adlayer||{},a=u.config||{};a.url=a.url||i.url,a.adsPerSpace=a.adsPerSpace||i.adsPerSpace,a.page=a.page||i.page,u.config=a;var f={};f.adserver=new t(a.url.adserver),f.adserver.name="adserver",f.tracker=new t(a.url.tracker),f.tracker.name="tracker";var l=new r;l.connection=f.adserver;var c=new n;c.connection=f.tracker,u.adserver=u.adserver||l,u.tracker=u.tracker||c,u.page=u.page||{},u.config=a,u.connections=u.connections||f,u.spaces=u.spaces||{},u.ads=u.ads||{},u.markAdAsLoaded=function(e){u.ads[e].emit("load")},u.lib=s("*"),o.adlayer=u}(this),function(t){function n(e,t,n){var r=[];t===null&&(t=document),n==null&&(n="*");var s=t.getElementsByTagName(n),o=s.length,u=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,j=0;i<o;i++)u.test(s[i].className)&&(r[j]=s[i],j++);return r}(function(){var i=t.adlayer,o=i.lib.AdApi,u=s("../lib/src/utils/contentloaded").contentloaded;u(e,function(){var t=e.document,r=n("adlayer_ad_placeholder",t);for(var s=0;s<r.length;s++){var u=r[s],a=u.id,f=u.parentNode,l=new o({id:a,adserver:i.adserver,document:t});l.init(i.tracker,function(){f.replaceChild(this.element,t.getElementById(this.id)),i.ads[a]=this})}})})()}(this)})(this)